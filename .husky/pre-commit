#!/usr/bin/env sh
set -eu

echo "ðŸ”  Running pre-commit checksâ€¦"

# 1. Vulnerability scan (high+ severity, prod deps only)
echo "ðŸ”  pnpm audit (high+)â€¦"
# Use --audit-level=high and omit dev deps for speed
pnpm audit --audit-level=high --silent || {
  echo "âŒ  High-severity vulnerabilities detected" >&2; exit 1; }

# 2. lint-staged (format + lint only the staged files)
echo "ðŸŽ¨  lint-staged (format & lint)â€¦"
# This will run formatter and linter on staged files per package.json config
npx --no-install lint-staged || { echo "âŒ  lint-staged failed" >&2; exit 1; }

# 3. Full-project lint (ensure no unchecked errors slip through)
echo "ðŸ§¹  ESLint (full project)â€¦"
pnpm run lint || { echo "âŒ  ESLint failed" >&2; exit 1; }

# 4. TypeScript type-check (fast, no emit)
echo "ðŸ”¡  Type-checkingâ€¦"
pnpm run typecheck || { echo "âŒ  Type-check failed" >&2; exit 1; }

echo "âœ…  Pre-commit passed!"
