<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'none'; style-src ${webview.cspSource}; script-src 'nonce-${nonce}';"
    />
    <link href="${styleUri}" rel="stylesheet" />
  </head>
  <body>
    <div class="header">
      <h1>Ralphban: Select Board</h1>
      <div class="search-filters">
        <input type="text" id="board-search" placeholder="Search boards..." class="search-input" />
      </div>
    </div>
    <div id="content" class="item-list">
      <div class="empty-state">Scanning workspace...</div>
    </div>

    <script nonce="${nonce}">
      const vscode = acquireVsCodeApi();
      let allBoards = [];

      window.addEventListener("message", (event) => {
        const message = event.data;
        switch (message.type) {
          case "list":
            allBoards = message.boards;
            renderList(allBoards);
            break;
        }
      });

      const searchInput = document.getElementById("board-search");
      searchInput.addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase();
        const filtered = allBoards.filter(
          (board) =>
            board.name.toLowerCase().includes(query) || board.path.toLowerCase().includes(query)
        );
        renderList(filtered);
      });

      function renderList(boards) {
        const container = document.getElementById("content");
        container.innerHTML = "";

        if (allBoards.length === 0) {
          const empty = document.createElement("div");
          empty.className = "empty-state";

          const text = document.createElement("div");
          text.textContent = "No Kanban boards found in workspace.";
          empty.appendChild(text);

          const createBtn = document.createElement("button");
          createBtn.className = "primary-button";
          createBtn.textContent = "Create New Board";
          createBtn.onclick = () => vscode.postMessage({ type: "create" });
          empty.appendChild(createBtn);

          container.appendChild(empty);
          return;
        }

        if (boards.length === 0) {
          const empty = document.createElement("div");
          empty.className = "empty-state";
          empty.textContent = "No board matches your search.";
          container.appendChild(empty);
          return;
        }

        // List boards as stylish items
        boards.forEach((board) => {
          const btn = document.createElement("button");
          btn.className = "list-item";

          const name = document.createElement("div");
          name.className = "list-item-title";
          name.textContent = board.name;

          const path = document.createElement("div");
          path.className = "list-item-subtitle";
          path.textContent = board.path;

          btn.appendChild(name);
          btn.appendChild(path);
          btn.onclick = () => vscode.postMessage({ type: "open", uri: board.uri });
          container.appendChild(btn);
        });

        const createBtn = document.createElement("button");
        createBtn.className = "secondary-button";
        createBtn.textContent = "+ Create New Board";
        createBtn.onclick = () => vscode.postMessage({ type: "create" });
        container.appendChild(createBtn);
      }

      // Request initial list
      vscode.postMessage({ type: "ready" });
    </script>
  </body>
</html>
